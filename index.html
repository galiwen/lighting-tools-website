<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-T">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Luminaire GWP Calculator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans:wght@400;500;700&display=swap" rel="stylesheet">
    <!-- Application Structure Plan: A two-tab single-page application. 
         'DATA' tab for all inputs. 
         'RESULTS' tab for charts.
         User flow: Input data -> Calculate -> View charts. -->
    <!-- Visualization & Content Choices: 
         - Charts: Stacked bar charts for GWP components. Stage A & EOL GWP correctly includes replacements. -->
    <style>
        body { font-family: 'Noto Sans', sans-serif; }
        .tab-button { 
            transition: background-color 0.2s ease, color 0.2s ease, border-color 0.2s ease; 
            border-bottom: 2px solid transparent;
            padding-bottom: calc(0.75rem - 2px); /* Adjust padding to account for border */
        }
        .tab-button.active { 
            border-bottom-color: black; 
            color: black; 
            font-weight: 500;
        }
        .tab-button:not(.active) { color: #4b5563; } /* gray-600 for inactive tab text */
        .tab-button:not(.active):hover { 
            border-bottom-color: #d1d5db; /* gray-300 for hover */
            color: black;
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 700px;
            margin-left: auto;
            margin-right: auto;
            height: 400px; 
            max-height: 450px;
            padding: 1rem;
            background-color: white;
            border-radius: 0.25rem; /* Slightly less rounded */
            border: 1px solid #e5e7eb; /* gray-200 border */
        }
        @media (min-width: 768px) { 
            .chart-container { height: 450px; }
        }
        @media (max-width: 639px) { 
            .chart-container { height: 350px; }
        }
        input[type="number"] {
            -moz-appearance: textfield;
        }
        input[type="number"]::-webkit-outer-spin-button,
        input[type="number"]::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        .form-input {
            border: 1px solid #d1d5db; /* gray-300 */
            border-radius: 0.25rem;
            box-shadow: none;
        }
        .form-input:focus {
            border-color: #6b7280; /* gray-500 */
            box-shadow: 0 0 0 1px #6b7280;
            outline: none;
        }
        .simple-section {
            border: 1px solid #e5e7eb; /* gray-200 */
            border-radius: 0.25rem;
        }
    </style>
</head>
<body class="bg-gray-50 text-black min-h-screen flex flex-col">

    <header class="bg-white py-6 border-b border-gray-200">
        <h1 class="text-3xl font-bold text-center text-black">LUMINAIRE GWP CALCULATOR AND COMPARISON TOOL</h1>
        <p class="text-xs text-gray-600 text-center mt-1">Developed by Dimitrios Tsiokaras - dimitrios@electrolight.com</p>
    </header>

    <main class="container mx-auto px-4 py-8 flex-grow">
        <div class="bg-white p-6 rounded-md border border-gray-200">
            <div class="mb-6 border-b border-gray-300">
                <nav class="flex space-x-2" aria-label="Tabs">
                    <button id="tab-data-btn" type="button" class="tab-button active px-4 py-3 font-medium text-sm focus:outline-none">
                        DATA
                    </button>
                    <button id="tab-results-btn" type="button" class="tab-button px-4 py-3 font-medium text-sm focus:outline-none">
                        RESULTS
                    </button>
                </nav>
            </div>

            <div id="tab-data-content">
                <p class="text-gray-600 mb-6 text-sm">
                    Enter the project-specific parameters and the technical data for up to three luminaires you wish to compare. All fields are required for accurate GWP calculations. Once data is entered, click "Calculate & View Results".
                </p>
                <form id="gwpForm">
                    <section id="projectParams" class="mb-8 p-6 bg-gray-50 simple-section">
                        <h2 class="text-xl font-semibold text-black mb-4">Project Parameters</h2>
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                            <div>
                                <label for="co2GridFactor" class="block text-sm font-medium text-black mb-1">CO2e Grid Factor (kg/kWh)</label>
                                <input type="number" id="co2GridFactor" value="0.233" step="0.001" class="form-input w-full p-2">
                            </div>
                            <div>
                                <label for="controlSystemCoefficient" class="block text-sm font-medium text-black mb-1">Control System Savings (%)</label>
                                <input type="number" id="controlSystemCoefficient" value="30" step="1" min="0" max="100" class="form-input w-full p-2">
                            </div>
                            <div>
                                <label for="operationalHoursYear" class="block text-sm font-medium text-black mb-1">Operational Hours/Year</label>
                                <input type="number" id="operationalHoursYear" value="3000" step="100" class="form-input w-full p-2">
                            </div>
                            <div>
                                <label for="anticipatedProjectLife" class="block text-sm font-medium text-black mb-1">Anticipated Project Life (years)</label>
                                <input type="number" id="anticipatedProjectLife" value="10" step="1" class="form-input w-full p-2">
                            </div>
                            <div>
                                <label for="maintenanceDimmingSavings" class="block text-sm font-medium text-black mb-1">Maintenance Dimming Savings (%)</label>
                                <input type="number" id="maintenanceDimmingSavings" value="10" step="1" min="0" max="100" class="form-input w-full p-2" title="Additional savings on operational energy after control system savings are applied.">
                            </div>
                            <div>
                                <label for="maintenanceFactorL70" class="block text-sm font-medium text-black mb-1">Maintenance Factor L70</label>
                                <input type="number" id="maintenanceFactorL70" value="0.70" step="0.01" min="0.01" max="1" class="form-input w-full p-2" title="E.g., 0.70. Applied to adjust operational GWP for L70 calculations.">
                            </div>
                            <div>
                                <label for="maintenanceFactorL90" class="block text-sm font-medium text-black mb-1">Maintenance Factor L90</label>
                                <input type="number" id="maintenanceFactorL90" value="0.90" step="0.01" min="0.01" max="1" class="form-input w-full p-2" title="E.g., 0.90. Applied to adjust operational GWP for L90 calculations.">
                            </div>
                        </div>
                    </section>

                    <div id="luminairesGridContainer" class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        </div>

                    <div class="mt-8 text-center">
                        <button type="submit" class="bg-black hover:bg-gray-700 text-white font-semibold py-2 px-6 rounded-md border border-black focus:outline-none focus:ring-2 focus:ring-gray-400 focus:ring-opacity-50 transition duration-150 ease-in-out">
                            Calculate & View Results
                        </button>
                    </div>
                </form>
            </div>

            <div id="tab-results-content" class="hidden">
                <p class="text-gray-600 mb-6 text-sm">
                    The charts below illustrate the Global Warming Potential (GWP) comparisons for the entered luminaires, broken down by lifecycle stage. Operational GWP (Stage B) is adjusted by the specified maintenance factors. Manufacturing (Stage A) and End-of-Life (EOL) GWP include replacements. Lower bars indicate a lower environmental impact.
                </p>
                <div class="space-y-8">
                    <div>
                        <h3 class="text-lg font-semibold text-black mb-2 text-center">GWP L90 vs L70 Comparison</h3>
                        <p class="text-sm text-gray-600 mb-3 text-center">Compares GWP components (kgCO2e) for each luminaire when considering L70 lifetime versus L90 lifetime. Stage B GWP is adjusted by L70 and L90 maintenance factors respectively.</p>
                        <div class="chart-container">
                            <canvas id="gwpL70L90Chart"></canvas>
                        </div>
                    </div>
                    <div>
                        <h3 class="text-lg font-semibold text-black mb-2 text-center">GWP Comparison With Control (L90 Baseline)</h3>
                        <p class="text-sm text-gray-600 mb-3 text-center">Shows GWP components (kgCO2e) for each luminaire (L90 lifetime, Stage B adjusted by L90 MF), comparing baseline operation versus operation with control system savings.</p>
                        <div class="chart-container">
                            <canvas id="gwpControlChart"></canvas>
                        </div>
                    </div>
                    <div>
                        <h3 class="text-lg font-semibold text-black mb-2 text-center">GWP With Control & Maintenance Dimming (L90 Baseline)</h3>
                        <p class="text-sm text-gray-600 mb-3 text-center">Compares GWP components (kgCO2e) for each luminaire (L90 lifetime, Stage B adjusted by L90 MF): with control system savings versus with both control system and maintenance dimming savings applied.</p>
                        <div class="chart-container">
                            <canvas id="gwpMaintenanceDimmingChart"></canvas>
                        </div>
                    </div>
                </div>
                 <div class="mt-8 text-center">
                    <button id="backToDataBtn" class="bg-gray-500 hover:bg-gray-600 text-white font-semibold py-2 px-6 rounded-md border border-gray-500 focus:outline-none focus:ring-2 focus:ring-gray-400 focus:ring-opacity-50 transition duration-150 ease-in-out mr-4">
                        Back to Data
                    </button>
                </div>
            </div>
        </div>
    </main>

    <footer class="text-center py-4 bg-gray-100 border-t border-gray-200 mt-auto">
        <p class="text-xs text-gray-500">Luminaire GWP Calculator v1.0</p>
    </footer>

    <script>
        const tabDataBtn = document.getElementById('tab-data-btn');
        const tabResultsBtn = document.getElementById('tab-results-btn');
        const tabDataContent = document.getElementById('tab-data-content');
        const tabResultsContent = document.getElementById('tab-results-content');
        const gwpForm = document.getElementById('gwpForm');
        const backToDataBtn = document.getElementById('backToDataBtn');
        const luminairesGridContainer = document.getElementById('luminairesGridContainer');

        let gwpL70L90ChartInstance, gwpControlChartInstance, gwpMaintenanceDimmingChartInstance;
        let shownLabelsForLegend = {}; 
        let currentLuminairesDataStorage = []; 

        const stageColors = {
            op: '#3b82f6',    // blue-500 (Operational Stage B)
            mfg: '#f97316',   // orange-500 (Manufacturing Stage A)
            eol: '#6b7280'    // stone-500 (EOL Stage EOL)
        };
        
        Chart.defaults.font.family = 'Noto Sans'; // Set default font for all charts

        const commonChartOptions = {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                y: {
                    beginAtZero: true,
                    stacked: true,
                    ticks: { color: '#000000', font: { family: 'Noto Sans'} }, 
                    grid: { color: '#e5e7eb' }, // gray-200
                    title: { display: true, text: 'GWP (kgCO2e)', color: '#000000', font: { family: 'Noto Sans', weight: '500'}} 
                },
                x: {
                    stacked: true,
                    ticks: { 
                        color: '#000000', maxRotation: 0, minRotation: 0, autoSkip: false, font: { family: 'Noto Sans'},
                        callback: function(value) {
                            const label = this.getLabelForValue(value);
                            return label.length > 16 ? label.substring(0, 15) + '...' : label;
                        }
                    },
                    grid: { display: false }
                }
            },
            plugins: {
                legend: {
                    position: 'top',
                    labels: {
                        color: '#000000', boxWidth: 15, padding: 20, font: { family: 'Noto Sans'}, 
                        filter: function(legendItem) {
                            const baseLabel = legendItem.text.split(' - ')[0];
                            if (!shownLabelsForLegend[baseLabel]) {
                                shownLabelsForLegend[baseLabel] = true;
                                return true;
                            }
                            return false;
                        }
                    }
                },
                tooltip: {
                    backgroundColor: 'rgba(0,0,0,0.85)', titleColor: 'white', bodyColor: 'white', mode: 'index', 
                    titleFont: { family: 'Noto Sans', weight: '500' },
                    bodyFont: { family: 'Noto Sans' },
                    callbacks: {
                        label: function(context) {
                            let label = context.dataset.label || '';
                            if (label) label = label.split(' - ')[0] + ': ';
                            if (context.parsed.y !== null) label += context.parsed.y.toFixed(2) + ' kgCO2e';
                            return label;
                        }
                    }
                }
            }
        };

        function renderLuminaireHTML(i) {
            const defaultWattageVals = [12, 10, 12];
            const defaultFluxVals = [1000, 1000, 900];
            const defaultQuantityVals = [120, 100, 130];
            const defaultL70Vals = [100000, 80000, 70000];
            const defaultL90Vals = [50000, 40000, 35000];
            const defaultGwpAVals = [10, 11, 15];
            const defaultGwpEOLVals = [0.5, 0.5, 1];

            const defaultWattageVal = defaultWattageVals[i-1];
            const defaultFluxVal = defaultFluxVals[i-1];
            let defaultEfficacyVal = (defaultWattageVal > 0 && defaultFluxVal >= 0) ? (defaultFluxVal / defaultWattageVal).toFixed(2) : '';
            
            return `
            <section id="luminaire${i}" class="p-6 bg-gray-50 simple-section">
                <h2 class="text-xl font-semibold text-black mb-4">Luminaire ${i}</h2>
                <div class="space-y-4">
                    <div><label for="wattage${i}" class="block text-sm font-medium text-black mb-1">Wattage (W)</label><input type="number" id="wattage${i}" value="${defaultWattageVal}" step="0.1" class="form-input w-full p-2"></div>
                    <div><label for="fluxLumen${i}" class="block text-sm font-medium text-black mb-1">Flux Lumens (lm)</label><input type="number" id="fluxLumen${i}" value="${defaultFluxVal}" step="10" class="form-input w-full p-2"></div>
                    <div><label for="efficacy${i}" class="block text-sm font-medium text-black mb-1">Efficacy (lm/W)</label><input type="number" id="efficacy${i}" value="${defaultEfficacyVal}" step="0.01" class="form-input w-full p-2 bg-gray-100 text-gray-600" readonly title="Calculated as Flux Lumens / Wattage. Informational."></div>
                    <div><label for="quantity${i}" class="block text-sm font-medium text-black mb-1">Quantity</label><input type="number" id="quantity${i}" value="${defaultQuantityVals[i-1]}" step="1" class="form-input w-full p-2"></div>
                    <div><label for="lifetimeL70_${i}" class="block text-sm font-medium text-black mb-1">Lifetime L70 (hours)</label><input type="number" id="lifetimeL70_${i}" value="${defaultL70Vals[i-1]}" step="1000" class="form-input w-full p-2"></div>
                    <div><label for="lifetimeL90_${i}" class="block text-sm font-medium text-black mb-1">Lifetime L90 (hours)</label><input type="number" id="lifetimeL90_${i}" value="${defaultL90Vals[i-1]}" step="1000" class="form-input w-full p-2"></div>
                    <div><label for="gwpStageA${i}" class="block text-sm font-medium text-black mb-1">GWP - Stage A (kgCO2e/unit)</label><input type="number" id="gwpStageA${i}" value="${defaultGwpAVals[i-1]}" step="0.1" class="form-input w-full p-2"></div>
                    <div><label for="gwpEOL${i}" class="block text-sm font-medium text-black mb-1">GWP - EOL (kgCO2e/unit)</label><input type="number" id="gwpEOL${i}" value="${defaultGwpEOLVals[i-1]}" step="0.1" class="form-input w-full p-2"></div>
                </div>
            </section>`;
        }

        function initializeLuminaireInputsAndEfficacyListeners() {
            luminairesGridContainer.innerHTML = [1, 2, 3].map(renderLuminaireHTML).join('');
            for (let i = 1; i <= 3; i++) {
                const wattageEl = document.getElementById(`wattage${i}`);
                const fluxEl = document.getElementById(`fluxLumen${i}`);
                const efficacyEl = document.getElementById(`efficacy${i}`);
                if (!wattageEl || !fluxEl || !efficacyEl) continue;
                function updateEfficacy() {
                    const wattage = parseFloat(wattageEl.value);
                    const flux = parseFloat(fluxEl.value);
                    efficacyEl.value = (wattage > 0 && flux >= 0) ? (flux / wattage).toFixed(2) : '';
                }
                wattageEl.addEventListener('input', updateEfficacy);
                fluxEl.addEventListener('input', updateEfficacy);
            }
        }
        
        initializeLuminaireInputsAndEfficacyListeners();

        function switchToTab(tabName) {
            tabDataBtn.classList.toggle('active', tabName === 'data');
            tabResultsBtn.classList.toggle('active', tabName !== 'data'); 
            tabDataContent.classList.toggle('hidden', tabName !== 'data');
            tabResultsContent.classList.toggle('hidden', tabName !== 'results'); 
        }

        tabDataBtn.addEventListener('click', () => switchToTab('data'));
        tabResultsBtn.addEventListener('click', () => switchToTab('results'));
        backToDataBtn.addEventListener('click', () => switchToTab('data'));
        
        function getFormValue(id, isFloat = true) {
            const element = document.getElementById(id);
            if (!element) { console.error(`Element ${id} not found.`); return NaN; }
            const value = element.value;
            const numValue = isFloat ? parseFloat(value) : parseInt(value);
            if (isNaN(numValue)) console.warn(`Value for ${id} is NaN: "${value}"`);
            return numValue;
        }

        gwpForm.addEventListener('submit', function(event) {
            event.preventDefault();
            if (calculateAndDisplayResults()) {
                switchToTab('results');
            }
        });

        function calculateAndDisplayResults() {
            const projectParams = {
                co2GridFactor: getFormValue('co2GridFactor'),
                controlSystemCoefficient: getFormValue('controlSystemCoefficient'),
                operationalHoursYear: getFormValue('operationalHoursYear'),
                anticipatedProjectLife: getFormValue('anticipatedProjectLife'),
                maintenanceDimmingSavings: getFormValue('maintenanceDimmingSavings'),
                maintenanceFactorL70: getFormValue('maintenanceFactorL70'),
                maintenanceFactorL90: getFormValue('maintenanceFactorL90')
            };

            if (Object.values(projectParams).some(isNaN) || projectParams.maintenanceFactorL70 <= 0 || projectParams.maintenanceFactorL90 <= 0) {
                alert("Ensure all Project Parameters are valid numbers and maintenance factors are > 0.");
                return false;
            }

            currentLuminairesDataStorage = []; 
            for (let i = 1; i <= 3; i++) {
                const luminaireInputs = {
                    name: `Luminaire ${i}`, 
                    wattage: getFormValue(`wattage${i}`),
                    quantity: getFormValue(`quantity${i}`), lifetimeL70: getFormValue(`lifetimeL70_${i}`),
                    lifetimeL90: getFormValue(`lifetimeL90_${i}`), gwpStageA_unit: getFormValue(`gwpStageA${i}`),
                    gwpEOL_unit: getFormValue(`gwpEOL${i}`)
                };

                if (Object.values(luminaireInputs).slice(1).some(isNaN) || luminaireInputs.lifetimeL70 <= 0 || luminaireInputs.lifetimeL90 <= 0) {
                    alert(`Ensure all fields for Luminaire ${i} are valid numbers and lifetimes > 0.`);
                    return false;
                }

                const totalOpHours = projectParams.operationalHoursYear * projectParams.anticipatedProjectLife;
                const calcGwp_A_EOL_Components = (lifetime) => {
                    const replacements = Math.max(0, Math.ceil(totalOpHours / lifetime) - 1); 
                    return { 
                        gwp_A: luminaireInputs.gwpStageA_unit * luminaireInputs.quantity * (1 + replacements), 
                        gwp_EOL: luminaireInputs.gwpEOL_unit * luminaireInputs.quantity * (1 + replacements) 
                    };
                };

                const componentsL70_AEOL = calcGwp_A_EOL_Components(luminaireInputs.lifetimeL70);
                const componentsL90_AEOL = calcGwp_A_EOL_Components(luminaireInputs.lifetimeL90);
                const baseEnergyConsumptionProjectLife = (luminaireInputs.wattage / 1000) * projectParams.operationalHoursYear * luminaireInputs.quantity * projectParams.anticipatedProjectLife;
                const gwp_B_base_unadjusted = baseEnergyConsumptionProjectLife * projectParams.co2GridFactor;

                const gwp_B_L70_adjusted = gwp_B_base_unadjusted / projectParams.maintenanceFactorL70;
                const gwp_B_L90_adjusted = gwp_B_base_unadjusted / projectParams.maintenanceFactorL90;
                const gwp_B_L90_control = gwp_B_L90_adjusted * (1 - projectParams.controlSystemCoefficient / 100);
                const gwp_B_L90_control_maint = gwp_B_L90_control * (1 - projectParams.maintenanceDimmingSavings / 100);

                currentLuminairesDataStorage.push({
                    name: luminaireInputs.name, 
                    l70_base: { gwp_A: componentsL70_AEOL.gwp_A, gwp_B_op: gwp_B_L70_adjusted, gwp_EOL: componentsL70_AEOL.gwp_EOL },
                    l90_base: { gwp_A: componentsL90_AEOL.gwp_A, gwp_B_op: gwp_B_L90_adjusted, gwp_EOL: componentsL90_AEOL.gwp_EOL },
                    l90_control: { gwp_A: componentsL90_AEOL.gwp_A, gwp_B_op: gwp_B_L90_control, gwp_EOL: componentsL90_AEOL.gwp_EOL },
                    l90_control_maint: { gwp_A: componentsL90_AEOL.gwp_A, gwp_B_op: gwp_B_L90_control_maint, gwp_EOL: componentsL90_AEOL.gwp_EOL }
                });
            }
            updateCharts(currentLuminairesDataStorage);
            return true;
        }

        function createStackedDatasets(data, scenarioKey, scenarioDisplayName, stackGroup) {
            const displaySuffix = scenarioDisplayName ? ` - ${scenarioDisplayName}` : '';
            return [
                { label: `Operational (B)${displaySuffix}`, data: data.map(d => d[scenarioKey].gwp_B_op), backgroundColor: stageColors.op, stack: `stack_${stackGroup}` },
                { label: `Manufacturing (A)${displaySuffix}`, data: data.map(d => d[scenarioKey].gwp_A), backgroundColor: stageColors.mfg, stack: `stack_${stackGroup}` },
                { label: `EOL${displaySuffix}`, data: data.map(d => d[scenarioKey].gwp_EOL), backgroundColor: stageColors.eol, stack: `stack_${stackGroup}` }
            ];
        }

        function updateCharts(data) {
            const labels = data.map(d => d.name);
            shownLabelsForLegend = {}; 

            // Calculate the maximum total GWP across all scenarios to ensure consistent scaling
            const maxGwpValues = [];
            data.forEach(d => {
                maxGwpValues.push(d.l70_base.gwp_A + d.l70_base.gwp_B_op + d.l70_base.gwp_EOL);
                maxGwpValues.push(d.l90_base.gwp_A + d.l90_base.gwp_B_op + d.l90_base.gwp_EOL);
                maxGwpValues.push(d.l90_control.gwp_A + d.l90_control.gwp_B_op + d.l90_control.gwp_EOL);
                maxGwpValues.push(d.l90_control_maint.gwp_A + d.l90_control_maint.gwp_B_op + d.l90_control_maint.gwp_EOL);
            });
            const maxGwp = Math.max(...maxGwpValues);
            const yAxisMax = Math.ceil(maxGwp * 1.1); // Add 10% padding

            // Create chart options with consistent y-axis maximum
            const consistentChartOptions = {
                ...commonChartOptions,
                scales: {
                    ...commonChartOptions.scales,
                    y: {
                        ...commonChartOptions.scales.y,
                        max: yAxisMax
                    }
                }
            };

            if (gwpL70L90ChartInstance) gwpL70L90ChartInstance.destroy();
            gwpL70L90ChartInstance = new Chart(document.getElementById('gwpL70L90Chart'), {
                type: 'bar', data: { labels, datasets: [ ...createStackedDatasets(data, 'l70_base', 'L70', 'L70'), ...createStackedDatasets(data, 'l90_base', 'L90', 'L90')]}, options: consistentChartOptions });

            if (gwpControlChartInstance) gwpControlChartInstance.destroy();
            gwpControlChartInstance = new Chart(document.getElementById('gwpControlChart'), {
                type: 'bar', data: { labels, datasets: [ ...createStackedDatasets(data, 'l90_base', 'L90 Baseline', 'L90Base'), ...createStackedDatasets(data, 'l90_control', 'L90 w/ Control', 'L90Control')]}, options: consistentChartOptions });
            
            if (gwpMaintenanceDimmingChartInstance) gwpMaintenanceDimmingChartInstance.destroy();
            gwpMaintenanceDimmingChartInstance = new Chart(document.getElementById('gwpMaintenanceDimmingChart'), {
                type: 'bar', data: { labels, datasets: [ ...createStackedDatasets(data, 'l90_control', 'L90 w/ Control', 'L90ControlAgain'), ...createStackedDatasets(data, 'l90_control_maint', 'L90 w/ Control & Maint. Dimming', 'L90ControlMaint')]}, options: consistentChartOptions });
        }
        
        switchToTab('data'); 
        calculateAndDisplayResults(); 

    </script>
</body>
</html>
